library("here")
library("tidyverse")
library("stringr")
w_files <- list.files(here::here('data_raw/prec_diaria_wimmed/'), pattern="*.txt")
i <- 1
name_f <- w_files[i]
name_f
star_date <- str_sub(name_f, start = 1, 10)
star_date
end_date <-
str_sub(name_f, start = 12, 21)
end_date
str_split(name_f, pattern = "_")
aux_name <- str_split(name_f, pattern = "_")
o <- c()
aux_name[[1]][1]
o$start_date <- as.Date(aux_name[[1]][1], format = "%Y-%m-%d")
as.Date(aux_name[[1]][1], format = "%Y-%m-%d")
str(as.Date(aux_name[[1]][1], format = "%Y-%m-%d"))
o <- c()
o$start_date <- as.Date(aux_name[[1]][1], format = "%Y-%m-%d")
o <- data.frame()
o$start_date <- as.Date(aux_name[[1]][1], format = "%Y-%m-%d")
end_date <- as.Date(aux_name[[1]][2], format = "%Y-%m-%d")
end_date
aux_name
variable <- a[[1]][3]
a <- str_split(name_f, pattern = "_")
start_date <- as.Date(a[[1]][1], format = "%Y-%m-%d")
end_date <- as.Date(a[[1]][2], format = "%Y-%m-%d")
variable <- a[[1]][3]
variable
name_station <- str_remove(a[[1]][4], pattern = ".txt")
name_station
station <- str_split(str_remove(a[[1]][4], pattern = ".txt"), pattern = " - ")
station_code <- station[[1]][1]
station_code
station_name <- station[[1]][2]
station_name
f <- readLines(here::here('data_raw/prec_diaria_wimmed/', i), skip = 2)
f <- readLines(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 2)
f <- read_file(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 2)
read_file()
?read_file
f <- read.table(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 2)
head(f)
head(f)[100]
head(f)[,100]
head(f)1:100
head(f)[1:100,]
f <- read.table(here::here('data_raw/prec_diaria_wimmed/', name_f))
f <- read.table(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 2)
name_f
View(f)
f <- read_csv(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 2)
head(f)
View(f)
f <- read.csv(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 2)
init <- readline(here::here('data_raw/prec_diaria_wimmed/', name_f), n = 1, skip = 1)
?readLines
?readLine
?readline
init <- readline(here::here('data_raw/prec_diaria_wimmed/', name_f), n = 1)
init <- readline(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 1)
init <- readline(here::here('data_raw/prec_diaria_wimmed/', name_f))
init <- readline(here::here('data_raw/prec_diaria_wimmed/', name_f), n=1, skip = 1)
init <- readline(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 1, n_max = 1)
init <- read_lines(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 1, n_max = 1)
init
init <- read_lines(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 0, n_max = 1)
init
as.Date(init, format = "%d %m %Y")
da <- ymd(as.Date(init, format = "%d %m %Y") + days(1)
da <- ymd(as.Date(init, format = "%d %m %Y")) + days(1)
library(lubridate)
da <- ymd(as.Date(init, format = "%d %m %Y")) + days(1)
ca
da
nrow(f)
da_out <- c()
for (d in 1:nrow(f)){
da <- ymd(as.Date(init, format = "%d %m %Y")) + days(d)
da_out <-c(da_out, da)
}
da_out <- c()
for (d in 1:200){
da <- ymd(as.Date(init, format = "%d %m %Y")) + days(d)
da_out <-c(da_out, da)
}
da_out
da <- seq.Date(as.Date(init, format = "%d %m %Y"), by = "day")
da <- seq.Date(as.Date(init, format = "%d %m %Y"), by = "day", along.with = nrow(f))
head(da)
da
nrow(f)
length(f)
da <- seq.Date(as.Date(init, format = "%d %m %Y"), by = "day", length.out = nrow(f))
da
tail(da)
ff <- cbind(f, da)
head(ff)
nrow(f)
length(da)
head(f)
f <- read.csv(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 2)
head(f)
f <- read.csv(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 1)
head(f)
f <- read.csv(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 2, header=FALSE)
head(f)
v <- read.csv(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 2, header=FALSE)
init <- read_lines(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 0, n_max = 1)
valores <- cbind(v, seq.Date(as.Date(init, format = "%d %m %Y"), by = "day", length.out = nrow(v)))
head(valores)
names(valores) <- c('prec', 'date')
head(valores)
precWimmed <- function(x) {
require(stringr)
out <- list()
name_f <- w_files[i]
a <- str_split(name_f, pattern = "_")
start_date <- as.Date(a[[1]][1], format = "%Y-%m-%d")
end_date <- as.Date(a[[1]][2], format = "%Y-%m-%d")
variable <- a[[1]][3]
station <- str_split(str_remove(a[[1]][4], pattern = ".txt"), pattern = " - ")
station_code <- station[[1]][1]
station_name <- station[[1]][2]
out$station_md <- cbind(station_code, station_name, variable, star_date, end_date)
v <- read.csv(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 2, header=FALSE)
init <- read_lines(here::here('data_raw/prec_diaria_wimmed/', name_f), skip = 0, n_max = 1)
valores <- cbind(station_code, v, seq.Date(as.Date(init, format = "%d %m %Y"), by = "day", length.out = nrow(v)))
names(valores) <- c("station_code", "prec", "date")
out$valores
return(out)
}
w_files <- list.files(here::here('data_raw/prec_diaria_wimmed/'), pattern="*.txt")
w_files[1]
path <- here::here("data_raw/prec_diaria_wimmed/")
name_f <- w_files[1]
path <- here::here("data_raw/prec_diaria_wimmed/")
name_f <- w_files[1]
precWimmed <- function(path, name_f) {
require(stringr)
out <- list()
a <- str_split(name_f, pattern = "_")
start_date <- as.Date(a[[1]][1], format = "%Y-%m-%d")
end_date <- as.Date(a[[1]][2], format = "%Y-%m-%d")
variable <- a[[1]][3]
station <- str_split(str_remove(a[[1]][4], pattern = ".txt"), pattern = " - ")
station_code <- station[[1]][1]
station_name <- station[[1]][2]
out$station_md <- cbind(station_code, station_name, variable, star_date, end_date)
v <- read.csv(paste0(path, name_f), skip = 2, header=FALSE)
init <- read_lines(paste0(path, name_f), skip = 0, n_max = 1)
valores <- cbind(station_code, v, seq.Date(as.Date(init, format = "%d %m %Y"), by = "day", length.out = nrow(v)))
names(valores) <- c("station_code", "prec", "date")
out$valores
return(out)
}
tetilla <- precWimmed(path, name_f)
tetilla
a <- str_split(name_f, pattern = "_")
a
end_date <- as.Date(a[[1]][2], format = "%Y-%m-%d")
end_date
p <- here::here("data_raw/prec_diaria_wimmed/")
n <- w_files[1]
precWimmed <- function(path, name_f) {
require(stringr)
out <- list()
a <- str_split(name_f, pattern = "_")
start_date <- as.Date(a[[1]][1], format = "%Y-%m-%d")
end_date <- as.Date(a[[1]][2], format = "%Y-%m-%d")
variable <- a[[1]][3]
station <- str_split(str_remove(a[[1]][4], pattern = ".txt"), pattern = " - ")
station_code <- station[[1]][1]
station_name <- station[[1]][2]
out$station_md <- cbind(station_code, station_name, variable, star_date, end_date)
v <- read.csv(paste0(path, name_f), skip = 2, header=FALSE)
init <- read_lines(paste0(path, name_f), skip = 0, n_max = 1)
valores <- cbind(station_code, v, seq.Date(as.Date(init, format = "%d %m %Y"), by = "day", length.out = nrow(v)))
names(valores) <- c("station_code", "prec", "date")
out$valores
return(out)
}
tetilla <- precWimmed(path = p, name_f = n)
tetilla
v <- read.csv(paste0(path, name_f), skip = 2, header=FALSE)
v
v <- read.csv(paste0(path, name_f), skip = 2, header=FALSE)
init <- read_lines(paste0(path, name_f), skip = 0, n_max = 1)
valores <- cbind(station_code, v, seq.Date(as.Date(init, format = "%d %m %Y"), by = "day", length.out = nrow(v)))
names(valores) <- c("station_code", "prec", "date")
w_files <- list.files(here::here('data_raw/prec_diaria_wimmed/'), pattern="*.txt")
p <- here::here("data_raw/prec_diaria_wimmed/")
n <- w_files[1]
precWimmed <- function(path, name_f) {
require(stringr)
out <- list()
a <- str_split(name_f, pattern = "_")
start_date <- as.Date(a[[1]][1], format = "%Y-%m-%d")
end_date <- as.Date(a[[1]][2], format = "%Y-%m-%d")
variable <- a[[1]][3]
station <- str_split(str_remove(a[[1]][4], pattern = ".txt"), pattern = " - ")
station_code <- station[[1]][1]
station_name <- station[[1]][2]
out$station_md <- cbind(station_code, station_name, variable, star_date, end_date)
v <- read.csv(paste0(path, name_f), skip = 2, header=FALSE)
init <- read_lines(paste0(path, name_f), skip = 0, n_max = 1)
valores <- cbind(station_code, v, seq.Date(as.Date(init, format = "%d %m %Y"), by = "day", length.out = nrow(v)))
names(valores) <- c("station_code", "prec", "date")
out$valores <- valores
return(out)
}
tetilla <- precWimmed(path = p, name_f = n)
library("here")
library("tidyverse")
library("stringr")
w_files <- list.files(here::here('data_raw/prec_diaria_wimmed/'), pattern="*.txt")
p <- here::here("data_raw/prec_diaria_wimmed/")
n <- w_files[1]
precWimmed <- function(path, name_f) {
require("stringr")
out <- list()
a <- str_split(name_f, pattern = "_")
start_date <- as.Date(a[[1]][1], format = "%Y-%m-%d")
end_date <- as.Date(a[[1]][2], format = "%Y-%m-%d")
variable <- a[[1]][3]
station <- str_split(str_remove(a[[1]][4], pattern = ".txt"), pattern = " - ")
station_code <- station[[1]][1]
station_name <- station[[1]][2]
out$station_md <- cbind(station_code, station_name, variable, star_date, end_date)
v <- read.csv(paste0(path, name_f), skip = 2, header=FALSE)
init <- read_lines(paste0(path, name_f), skip = 0, n_max = 1)
valores <- cbind(station_code, v, seq.Date(as.Date(init, format = "%d %m %Y"), by = "day", length.out = nrow(v)))
names(valores) <- c("station_code", "prec", "date")
out$valores <- valores
return(out)
}
tetilla <- precWimmed(path = p, name_f = n)
w_files <- list.files(here::here('data_raw/prec_diaria_wimmed/'), pattern="*.txt")
w_files <- list.files(here::here('data_raw/prec_diaria_wimmed/'), pattern="*.txt")
w_files
p <- here::here("data_raw/prec_diaria_wimmed/")
p
n <- w_files[1]
out <- list()
name_f <- n
a <- str_split(name_f, pattern = "_")
a
start_date <- as.Date(a[[1]][1], format = "%Y-%m-%d")
start_date
end_date <- as.Date(a[[1]][2], format = "%Y-%m-%d")
end_date
variable <- a[[1]][3]
station <- str_split(str_remove(a[[1]][4], pattern = ".txt"), pattern = " - ")
station_code <- station[[1]][1]
library("here")
library("tidyverse")
library("stringr")
w_files <- list.files(here::here('data_raw/prec_diaria_wimmed/'), pattern="*.txt")
p <- here::here("data_raw/prec_diaria_wimmed/")
n <- w_files[1]
precWimmed <- function(path, name_f) {
require("stringr")
out <- list()
a <- str_split(name_f, pattern = "_")
start_date <- as.Date(a[[1]][1], format = "%Y-%m-%d")
end_date <- as.Date(a[[1]][2], format = "%Y-%m-%d")
variable <- a[[1]][3]
station <- str_split(str_remove(a[[1]][4], pattern = ".txt"), pattern = " - ")
station_code <- station[[1]][1]
station_name <- station[[1]][2]
out$station_md <- cbind(station_code, station_name, variable, start_date, end_date)
v <- read.csv(paste0(path, name_f), skip = 2, header=FALSE)
init <- read_lines(paste0(path, name_f), skip = 0, n_max = 1)
valores <- cbind(station_code, v, seq.Date(as.Date(init, format = "%d %m %Y"), by = "day", length.out = nrow(v)))
names(valores) <- c("station_code", "prec", "date")
out$valores <- valores
return(out)
}
tetilla <- precWimmed(path = p, name_f = n)
tetilla$station_md
library("here")
library("tidyverse")
library("stringr")
w_files <- list.files(here::here('data_raw/prec_diaria_wimmed/'), pattern="*.txt")
p <- here::here("data_raw/prec_diaria_wimmed/")
n <- w_files[1]
precWimmed <- function(path, name_f) {
require("stringr")
out <- list()
a <- str_split(name_f, pattern = "_")
start_date <- a[[1]][1]
end_date <- a[[1]][2]
variable <- a[[1]][3]
station <- str_split(str_remove(a[[1]][4], pattern = ".txt"), pattern = " - ")
station_code <- station[[1]][1]
station_name <- station[[1]][2]
out$station_md <- cbind(station_code, station_name, variable, start_date, end_date)
v <- read.csv(paste0(path, name_f), skip = 2, header=FALSE)
init <- read_lines(paste0(path, name_f), skip = 0, n_max = 1)
valores <- cbind(station_code, v, seq.Date(as.Date(init, format = "%d %m %Y"), by = "day", length.out = nrow(v)))
names(valores) <- c("station_code", "prec", "date")
out$valores <- valores
return(out)
}
tetilla <- precWimmed(path = p, name_f = n)
tetilla$station_md
tetilla$valores
tail(tetilla$valores)
tetilla$station_md
o <- c()
p <- here::here("data_raw/prec_diaria_wimmed/")
for (i in 1:length(w_files)) {
ajo <- precWimmed(path = p, name_f = w_files[i])
o <- bind_rows(o, ajo$valores)
}
warnings()
head(o)
library("tidyverse")
o$prec <- ifelse(o$prec == -9999, NA, o$prec)
head(o$prec)
length(is.na(o$prec))
